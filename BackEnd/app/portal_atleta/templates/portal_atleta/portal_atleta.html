{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Portal do Atleta</title>
    <link rel="stylesheet" href="{% static 'portal_atleta/css/portal_atleta.css' %}">
</head>
<body>
    <!-- Painel Principal -->
    <div id="main-screen" class="screen active">
        <button class="toggle-btn" onclick="toggleSidebar()">
            <i class="bi bi-list"></i>
        </button>
        <div class="sidebar" id="sidebar" style="
            background: 
                linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                url('../img/sidebar.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        ">
            <br>
            <a href="#" data-screen="dashboard"><i class="bi bi-house-door"></i><span>Dashboard</span></a>
            <a href="#" data-screen="perfil"><i class="bi bi-person-circle"></i><span>Meu Perfil</span></a>
            <a href="#" data-screen="competicoes"><i class="bi bi-trophy"></i><span>Competições</span></a>
            <a href="#" data-screen="resultados"><i class="bi bi-clipboard-data"></i><span>Resultados</span></a>
            <a href="#" data-screen="configuracoes"><i class="bi bi-gear"></i><span>Configurações</span></a>
        </div>
        <div class="content" id="content">
            <div class="header">
                <h2 id="screen-title"><i class="fas fa-home"></i> Dashboard</h2>
                <div class="user-dropdown">
                    <div class="user-icon-container">
                        {% if atleta %}
                            <span class="me-2 text-white">{{ atleta.nome_completo|truncatechars:20 }}</span>
                        {% endif %}
                        <i class="bi bi-person-circle user-icon"></i>
                        <i class="bi bi-chevron-down arrow-icon"></i>
                    </div>
                    <div class="dropdown-menu">
                        <a href="#" data-screen="perfil"><i class="fas fa-user"></i> Meu Perfil</a>
                        <a href="#" data-screen="configuracoes"><i class="fas fa-cog"></i> Configurações</a>
                        <a href="{% url 'dashboard:home' %}" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Voltar ao Sistema</a>
                    </div>
                </div>
            </div>
                    </div>
                </div>
            </div>
            <br>
            
            <!-- Dashboard -->
            <main class="container-fluid mt-4" id="dashboard-screen" data-screen-content>
                {% if error == 'no_athlete' %}
                <div class="alert alert-warning" role="alert">
                    <i class="bi bi-exclamation-triangle"></i>
                    Nenhum atleta encontrado no sistema. Por favor, cadastre atletas primeiro.
                </div>
                {% else %}
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title"><i class="bi bi-calendar-check"></i> Próximos Eventos</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Evento</th>
                                                <th>Tipo</th>
                                                <th>Local</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for evento in proximos_eventos %}
                                            <tr>
                                                <td>{{ evento.data|date:"d/m/Y" }}</td>
                                                <td>{{ evento.evento }}</td>
                                                <td>{{ evento.tipo }}</td>
                                                <td>{{ evento.local }}</td>
                                                <td>
                                                    {% if evento.status == 'Confirmado' %}
                                                        <span class="badge bg-success">{{ evento.status }}</span>
                                                    {% elif evento.status == 'Ativa' %}
                                                        <span class="badge bg-success">Confirmado</span>
                                                    {% elif evento.status == 'Em breve' %}
                                                        <span class="badge bg-warning">Em breve</span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">{{ evento.status }}</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="5" class="text-center text-muted">
                                                    <i class="bi bi-calendar-x"></i> Nenhum evento próximo encontrado
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title"><i class="bi bi-bell"></i> Notificações Recentes</h5>
                            </div>
                            <div class="card-body">
                                <div class="list-group">
                                    {% for notif in notificacoes %}
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">{{ notif.titulo }}</h6>
                                            <small>{{ notif.tempo }}</small>
                                        </div>
                                        <p class="mb-1">{{ notif.mensagem }}</p>
                                    </a>
                                    {% empty %}
                                    <div class="text-center text-muted">
                                        <i class="bi bi-bell-slash"></i> Nenhuma notificação
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="card-title"><i class="bi bi-graph-up"></i> Desempenho Recente</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="dashboardPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="card-title"><i class="bi bi-trophy"></i> Conquistas</h5>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="stat-card" style="background: linear-gradient(135deg, #ffc107, #f0ad4e);">
                                            <div class="stat-card-content">
                                                <h5><i class="bi bi-award-fill me-2"></i>Ouro</h5>
                                                <p class="fs-2">{{ medalhas.ouro }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-card" style="background: linear-gradient(135deg, #6c757d, #5a6268);">
                                            <div class="stat-card-content">
                                                <h5><i class="bi bi-award-fill me-2"></i>Prata</h5>
                                                <p class="fs-2">{{ medalhas.prata }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-card" style="background: linear-gradient(135deg, #cd7f32, #b87333);">
                                            <div class="stat-card-content">
                                                <h5><i class="bi bi-award-fill me-2"></i>Bronze</h5>
                                                <p class="fs-2">{{ medalhas.bronze }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <h6>Últimas Conquistas:</h6>
                                    <ul class="list-group">
                                        {% for conquista in ultimas_conquistas %}
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            {% if conquista.posicao == 1 %}
                                                <span><i class="bi bi-award-fill text-warning"></i> 1º Lugar - {{ conquista.competicao.nome }}</span>
                                            {% elif conquista.posicao == 2 %}
                                                <span><i class="bi bi-award-fill text-secondary"></i> 2º Lugar - {{ conquista.competicao.nome }}</span>
                                            {% elif conquista.posicao == 3 %}
                                                <span><i class="bi bi-award-fill" style="color: #cd7f32;"></i> 3º Lugar - {{ conquista.competicao.nome }}</span>
                                            {% endif %}
                                            <span class="badge bg-primary rounded-pill">{{ conquista.data_criacao|date:"d/m/Y" }}</span>
                                        </li>
                                        {% empty %}
                                        <li class="list-group-item text-center text-muted">
                                            <i class="bi bi-trophy"></i> Nenhuma conquista registrada ainda
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </main>
            
            <!-- Perfil do Atleta -->
            <main class="container-fluid mt-4" id="perfil-screen" data-screen-content style="display: none;">
                {% if not error %}
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <div class="card profile-card">
                            {% if atleta.foto %}
                                <img src="{{ atleta.foto.url }}" alt="Foto do Atleta" class="profile-img mx-auto d-block">
                            {% else %}
                                <img src="{% static 'img/default-avatar.png' %}" alt="Foto do Atleta" class="profile-img mx-auto d-block">
                            {% endif %}
                            <h3 class="profile-name">{{ atleta.nome_completo }}</h3>
                            <p class="profile-title">{{ atleta.get_faixa_display }}{% if atleta.faixa == 'preta' %} - Dan{% endif %}</p>
                            <div class="profile-details">
                                <div class="profile-detail">
                                    <i class="bi bi-calendar"></i>
                                    <span>Idade: {{ atleta.idade|default:"N/A" }} anos</span>
                                </div>
                                <div class="profile-detail">
                                    <i class="bi bi-geo-alt"></i>
                                    <span>Cidade: {{ atleta.cidade }}/{{ atleta.estado }}</span>
                                </div>
                                {% if atleta.academia %}
                                <div class="profile-detail">
                                    <i class="bi bi-people"></i>
                                    <span>Equipe: {{ atleta.academia.nome }}</span>
                                </div>
                                {% endif %}
                                {% if atleta.categoria %}
                                <div class="profile-detail">
                                    <i class="bi bi-award"></i>
                                    <span>Categoria: {{ atleta.categoria.nome }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title"><i class="bi bi-info-circle"></i> Informações Pessoais</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Nome Completo</label>
                                            <input type="text" class="form-control" value="{{ atleta.nome_completo }}" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Data de Nascimento</label>
                                            <input type="text" class="form-control" value="{{ atleta.data_nascimento|date:'d/m/Y' }}" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Sexo</label>
                                            <input type="text" class="form-control" value="{{ atleta.get_sexo_display }}" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">E-mail</label>
                                            <input type="text" class="form-control" value="{{ atleta.email|default:'Não informado' }}" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Telefone</label>
                                            <input type="text" class="form-control" value="{{ atleta.telefone|default:'Não informado' }}" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Graduação</label>
                                            <input type="text" class="form-control" value="{{ atleta.get_faixa_display }}" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Peso</label>
                                            <input type="text" class="form-control" value="{% if atleta.peso %}{{ atleta.peso }} kg{% else %}Não informado{% endif %}" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Altura</label>
                                            <input type="text" class="form-control" value="{% if atleta.altura %}{{ atleta.altura }} cm{% else %}Não informado{% endif %}" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-end mt-3">
                                    <button class="btn btn-primary" disabled>Editar Informações</button>
                                    <small class="text-muted d-block">Para editar, entre em contato com a administração</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="bi bi-bar-chart"></i> Estatísticas de Competições
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-md-3">
                                        <div class="stat-card" style="background: linear-gradient(135deg, #007bff, #0056b3);">
                                            <div class="stat-card-content">
                                                <h5><i class="bi bi-trophy me-2"></i>Competições</h5>
                                                <p class="fs-2">{{ total_competicoes }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card" style="background: linear-gradient(135deg, #28a745, #1e7e34);">
                                            <div class="stat-card-content">
                                                <h5><i class="bi bi-graph-up me-2"></i>Resultados</h5>
                                                <p class="fs-2">{{ total_resultados }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card" style="background: linear-gradient(135deg, #ffc107, #e0a800);">
                                            <div class="stat-card-content">
                                                <h5><i class="bi bi-award me-2"></i>Pódios</h5>
                                                <p class="fs-2">{{ medalhas.ouro|add:medalhas.prata|add:medalhas.bronze }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-card" style="background: linear-gradient(135deg, #6f42c1, #563d7c);">
                                            <div class="stat-card-content">
                                                <h5><i class="bi bi-calendar me-2"></i>Desde</h5>
                                                <p class="fs-5">{{ atleta.data_inscricao|date:'M/Y' }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </main>

            <!-- Competições -->
            <main class="container-fluid mt-4" id="competicoes-screen" data-screen-content style="display: none;">
                {% if not error %}
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-0"><i class="bi bi-trophy"></i> Minhas Competições</h5>
                                    <div class="badge bg-info">Total: {{ total_competicoes }}</div>
                                </div>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs" id="competitionsTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button" role="tab">
                                            Próximas ({{ competicoes_proximas.count }})
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button" role="tab">
                                            Passadas ({{ competicoes_passadas.count }})
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">
                                            Todas ({{ todas_competicoes.count }})
                                        </button>
                                    </li>
                                </ul>
                                <div class="tab-content" id="competitionsTabContent">
                                    <!-- Próximas Competições -->
                                    <div class="tab-pane fade show active" id="upcoming" role="tabpanel">
                                        <div class="table-responsive mt-3">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Data</th>
                                                        <th>Competição</th>
                                                        <th>Local</th>
                                                        <th>Modalidade</th>
                                                        <th>Status</th>
                                                        <th>Ações</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for competicao in competicoes_proximas %}
                                                    <tr>
                                                        <td>{{ competicao.data_inicio|date:"d/m/Y" }}</td>
                                                        <td>{{ competicao.nome }}</td>
                                                        <td>{{ competicao.local }}</td>
                                                        <td>{{ competicao.modalidade }}</td>
                                                        <td>
                                                            {% if competicao.status == 'Ativa' %}
                                                                <span class="badge bg-success">Confirmado</span>
                                                            {% elif competicao.status == 'Em breve' %}
                                                                <span class="badge bg-warning">Em breve</span>
                                                            {% else %}
                                                                <span class="badge bg-secondary">{{ competicao.status }}</span>
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            <a href="{% url 'portal_atleta:detalhes_competicao' competicao.id %}" class="btn btn-sm btn-outline-primary">Detalhes</a>
                                                        </td>
                                                    </tr>
                                                    {% empty %}
                                                    <tr>
                                                        <td colspan="6" class="text-center text-muted">
                                                            <i class="bi bi-calendar-x"></i> Nenhuma competição próxima
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    
                                    <!-- Competições Passadas -->
                                    <div class="tab-pane fade" id="past" role="tabpanel">
                                        <div class="table-responsive mt-3">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Data</th>
                                                        <th>Competição</th>
                                                        <th>Local</th>
                                                        <th>Modalidade</th>
                                                        <th>Resultado</th>
                                                        <th>Ações</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for competicao in competicoes_passadas %}
                                                    <tr>
                                                        <td>{{ competicao.data_inicio|date:"d/m/Y" }}</td>
                                                        <td>{{ competicao.nome }}</td>
                                                        <td>{{ competicao.local }}</td>
                                                        <td>{{ competicao.modalidade }}</td>
                                                        <td>
                                                            {% for resultado in resultados_kata %}
                                                                {% if resultado.competicao.id == competicao.id %}
                                                                    {% if resultado.posicao == 1 %}
                                                                        <span class="badge bg-warning">1º Lugar</span>
                                                                    {% elif resultado.posicao == 2 %}
                                                                        <span class="badge bg-secondary">2º Lugar</span>
                                                                    {% elif resultado.posicao == 3 %}
                                                                        <span class="badge" style="background-color: #cd7f32;">3º Lugar</span>
                                                                    {% elif resultado.status == 'eliminado' %}
                                                                        <span class="badge bg-danger">Eliminado</span>
                                                                    {% else %}
                                                                        <span class="badge bg-info">{{ resultado.posicao }}º</span>
                                                                    {% endif %}
                                                                {% endif %}
                                                            {% empty %}
                                                                <span class="badge bg-light text-dark">Sem resultado</span>
                                                            {% endfor %}
                                                        </td>
                                                        <td>
                                                            <a href="{% url 'portal_atleta:detalhes_competicao' competicao.id %}" class="btn btn-sm btn-outline-primary">Detalhes</a>
                                                        </td>
                                                    </tr>
                                                    {% empty %}
                                                    <tr>
                                                        <td colspan="6" class="text-center text-muted">
                                                            <i class="bi bi-calendar-x"></i> Nenhuma competição passada
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    
                                    <!-- Todas as Competições -->
                                    <div class="tab-pane fade" id="all" role="tabpanel">
                                        <div class="table-responsive mt-3">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Data</th>
                                                        <th>Competição</th>
                                                        <th>Local</th>
                                                        <th>Modalidade</th>
                                                        <th>Status</th>
                                                        <th>Resultado</th>
                                                        <th>Ações</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for competicao in todas_competicoes %}
                                                    <tr>
                                                        <td>{{ competicao.data_inicio|date:"d/m/Y" }}</td>
                                                        <td>{{ competicao.nome }}</td>
                                                        <td>{{ competicao.local }}</td>
                                                        <td>{{ competicao.modalidade }}</td>
                                                        <td>
                                                            {% if competicao.data_inicio >= hoje %}
                                                                {% if competicao.status == 'Ativa' %}
                                                                    <span class="badge bg-success">Confirmado</span>
                                                                {% else %}
                                                                    <span class="badge bg-warning">{{ competicao.status }}</span>
                                                                {% endif %}
                                                            {% else %}
                                                                <span class="badge bg-secondary">Concluído</span>
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {% if competicao.data_inicio < hoje %}
                                                                {% for resultado in resultados_kata %}
                                                                    {% if resultado.competicao.id == competicao.id %}
                                                                        {% if resultado.posicao == 1 %}
                                                                            <span class="badge bg-warning">1º Lugar</span>
                                                                        {% elif resultado.posicao == 2 %}
                                                                            <span class="badge bg-secondary">2º Lugar</span>
                                                                        {% elif resultado.posicao == 3 %}
                                                                            <span class="badge" style="background-color: #cd7f32;">3º Lugar</span>
                                                                        {% elif resultado.status == 'eliminado' %}
                                                                            <span class="badge bg-danger">Eliminado</span>
                                                                        {% else %}
                                                                            <span class="badge bg-info">{{ resultado.posicao }}º</span>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% empty %}
                                                                    <span class="badge bg-light text-dark">Sem resultado</span>
                                                                {% endfor %}
                                                            {% else %}
                                                                <span class="text-muted">-</span>
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            <a href="{% url 'portal_atleta:detalhes_competicao' competicao.id %}" class="btn btn-sm btn-outline-primary">Detalhes</a>
                                                        </td>
                                                    </tr>
                                                    {% empty %}
                                                    <tr>
                                                        <td colspan="7" class="text-center text-muted">
                                                            <i class="bi bi-trophy"></i> Nenhuma competição encontrada
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </main>
            
            <!-- Resultados -->
            <main class="container-fluid mt-4" id="resultados-screen" data-screen-content style="display: none;">
                {% if not error %}
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-0"><i class="bi bi-clipboard-data"></i> Meus Resultados</h5>
                                    <div class="badge bg-info">Total: {{ total_resultados }}</div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Competição</th>
                                                <th>Categoria</th>
                                                <th>Fase</th>
                                                <th>Posição</th>
                                                <th>Pontuação</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for resultado in resultados_kata %}
                                            <tr>
                                                <td>{{ resultado.data_criacao|date:"d/m/Y" }}</td>
                                                <td>{{ resultado.competicao.nome }}</td>
                                                <td>{{ resultado.categoria.nome }}</td>
                                                <td>
                                                    <span class="badge bg-info">{{ resultado.get_fase_display }}</span>
                                                </td>
                                                <td>
                                                    {% if resultado.posicao == 1 %}
                                                        <span class="badge bg-warning"><i class="bi bi-trophy-fill"></i> 1º Lugar</span>
                                                    {% elif resultado.posicao == 2 %}
                                                        <span class="badge bg-secondary"><i class="bi bi-award-fill"></i> 2º Lugar</span>
                                                    {% elif resultado.posicao == 3 %}
                                                        <span class="badge" style="background-color: #cd7f32;"><i class="bi bi-award-fill"></i> 3º Lugar</span>
                                                    {% elif resultado.posicao %}
                                                        <span class="badge bg-light text-dark">{{ resultado.posicao }}º</span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">-</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <strong>{{ resultado.total|floatformat:2 }}</strong>
                                                    <br>
                                                    <small class="text-muted">
                                                        Notas: {{ resultado.nota1|floatformat:1 }}, {{ resultado.nota2|floatformat:1 }}, {{ resultado.nota3|floatformat:1 }}, {{ resultado.nota4|floatformat:1 }}, {{ resultado.nota5|floatformat:1 }}
                                                    </small>
                                                </td>
                                                <td>
                                                    {% if resultado.status == 'classificado' %}
                                                        <span class="badge bg-success">Classificado</span>
                                                    {% elif resultado.status == 'eliminado' %}
                                                        <span class="badge bg-danger">Eliminado</span>
                                                    {% else %}
                                                        <span class="badge bg-primary">{{ resultado.get_status_display }}</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="7" class="text-center text-muted">
                                                    <i class="bi bi-clipboard-x"></i> Nenhum resultado encontrado
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                
                                {% if resultados_kata %}
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="card-title mb-0"><i class="bi bi-bar-chart"></i> Estatísticas por Fase</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row text-center">
                                                    <div class="col-4">
                                                        <div class="stat-item">
                                                            <h6>Elim.</h6>
                                                            <p class="mb-0">
                                                                {% for resultado in resultados_kata %}
                                                                    {% if resultado.fase == 'eliminatorias' %}{{ forloop.counter }}{% endif %}
                                                                {% empty %}0
                                                                {% endfor %}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="stat-item">
                                                            <h6>Semi.</h6>
                                                            <p class="mb-0">
                                                                {% for resultado in resultados_kata %}
                                                                    {% if resultado.fase == 'semifinal' %}{{ forloop.counter }}{% endif %}
                                                                {% empty %}0
                                                                {% endfor %}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="stat-item">
                                                            <h6>Final</h6>
                                                            <p class="mb-0">
                                                                {% for resultado in resultados_kata %}
                                                                    {% if resultado.fase == 'final' %}{{ forloop.counter }}{% endif %}
                                                                {% empty %}0
                                                                {% endfor %}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="card-title mb-0"><i class="bi bi-graph-up"></i> Melhor Pontuação</h6>
                                            </div>
                                            <div class="card-body text-center">
                                                {% if resultados_kata %}
                                                    {% for resultado in resultados_kata %}
                                                        {% if forloop.first %}
                                                            <h3 class="text-primary">{{ resultado.total|floatformat:2 }}</h3>
                                                            <p class="mb-0">{{ resultado.competicao.nome }}</p>
                                                            <small class="text-muted">{{ resultado.data_criacao|date:"d/m/Y" }}</small>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% else %}
                                                    <h3 class="text-muted">-</h3>
                                                    <p class="mb-0">Nenhum resultado</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </main>
            
            <!-- Configurações -->
            <main class="container-fluid mt-4" id="configuracoes-screen" data-screen-content style="display: none;">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title"><i class="bi bi-gear"></i> Configurações</h5>
                            </div>
                            <div class="list-group list-group-flush">
                                <a href="#" class="list-group-item list-group-item-action active" data-settings-tab="profile">Perfil</a>
                                <a href="#" class="list-group-item list-group-item-action" data-settings-tab="security">Segurança</a>
                                <a href="#" class="list-group-item list-group-item-action" data-settings-tab="privacy">Privacidade</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title" id="settings-tab-title">Configurações de Perfil</h5>
                            </div>
                            <div class="card-body" id="settings-content">
                                <!-- Conteúdo de Perfil -->
                                <div class="settings-section" id="profile-settings">
                                    <form>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="first-name" class="form-label">Nome</label>
                                                <input type="text" class="form-control" id="first-name" value="Erminio">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="last-name" class="form-label">Sobrenome</label>
                                                <input type="text" class="form-control" id="last-name" value="Apaixonado">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="email" class="form-label">E-mail</label>
                                            <input type="email" class="form-control" id="email" value="erminioapaixonado@email.com">
                                        </div>
                                        <div class="mb-3">
                                            <label for="phone" class="form-label">Telefone</label>
                                            <input type="tel" class="form-control" id="phone" value="(91) 98608-3776">
                                        </div>
                                        <div class="mb-3">
                                            <label for="birthdate" class="form-label">Data de Nascimento</label>
                                            <input type="date" class="form-control" id="birthdate" value="1995-03-15">
                                        </div>
                                        <div class="mb-3">
                                            <label for="profile-photo" class="form-label">Foto de Perfil</label>
                                            <input type="file" class="form-control" id="profile-photo">
                                        </div>
                                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                                    </form>
                                </div>
                                
                                <!-- Conteúdo de Segurança -->
                                <div class="settings-section" id="security-settings" style="display: none;">
                                    <form>
                                        <div class="mb-3">
                                            <label for="current-password" class="form-label">Senha Atual</label>
                                            <input type="password" class="form-control" id="current-password">
                                        </div>
                                        <div class="mb-3">
                                            <label for="new-password" class="form-label">Nova Senha</label>
                                            <input type="password" class="form-control" id="new-password">
                                        </div>
                                        <div class="mb-3">
                                            <label for="confirm-password" class="form-label">Confirmar Nova Senha</label>
                                            <input type="password" class="form-control" id="confirm-password">
                                        </div>
                                        <button type="submit" class="btn btn-primary">Alterar Senha</button>
                                    </form>
                                    <div class="mt-4">
                                        <h6>Sessões Ativas</h6>
                                        <div class="list-group">
                                            <div class="list-group-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <strong>Chrome - Windows</strong>
                                                        <div class="text-muted">Belém, PA - 15/06/2025 14:30</div>
                                                    </div>
                                                    <button class="btn btn-sm btn-outline-danger">Encerrar</button>
                                                </div>
                                            </div>
                                            <div class="list-group-item">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <strong>Safari - iPhone</strong>
                                                        <div class="text-muted">Belém, PA - 14/06/2025 09:15</div>
                                                    </div>
                                                    <button class="btn btn-sm btn-outline-danger">Encerrar</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Conteúdo de Privacidade -->
                                <div class="settings-section" id="privacy-settings" style="display: none;">
                                    <form>
                                        <h6 class="mb-3">Configurações de Privacidade</h6>
                                        <div class="mb-3">
                                            <label for="profile-visibility" class="form-label">Visibilidade do Perfil</label>
                                            <select class="form-select" id="profile-visibility">
                                                <option value="public">Público (qualquer pessoa pode ver)</option>
                                                <option value="members">Apenas membros do sistema</option>
                                                <option value="private">Privado (apenas eu)</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="results-visibility" class="form-label">Visibilidade de Resultados</label>
                                            <select class="form-select" id="results-visibility">
                                                <option value="public">Público (qualquer pessoa pode ver)</option>
                                                <option value="members" selected>Apenas membros do sistema</option>
                                                <option value="private">Privado (apenas eu)</option>
                                            </select>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="show-contact-info">
                                            <label class="form-check-label" for="show-contact-info">Mostrar informações de contato no perfil</label>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="show-birthdate">
                                            <label class="form-check-label" for="show-birthdate">Mostrar data de nascimento no perfil</label>
                                        </div>
                                        
                                        <h6 class="mb-3 mt-4">Exportar Dados</h6>
                                        <p class="text-muted">Você pode baixar uma cópia dos seus dados pessoais.</p>
                                        <button type="button" class="btn btn-outline-primary">Exportar Meus Dados</button>
                                        
                                        <h6 class="mb-3 mt-4">Excluir Conta</h6>
                                        <p class="text-muted">Esta ação é irreversível e removerá permanentemente sua conta e todos os dados associados.</p>
                                        <button type="button" class="btn btn-outline-danger">Excluir Minha Conta</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'portal_atleta/js/portal_atleta.js' %}"></script>
    
    <!-- Scripts para dados dinâmicos -->
    <script>
        // Dados do backend para JavaScript
        {% if dados_grafico_json and labels_grafico_json %}
        const dadosGrafico = {{ dados_grafico_json|safe }};
        const labelsGrafico = {{ labels_grafico_json|safe }};
        {% else %}
        const dadosGrafico = [];
        const labelsGrafico = [];
        {% endif %}
        
        // Dados do atleta
        window.atletaData = {
            {% if atleta %}
            nome: "{{ atleta.nome_completo|escapejs }}",
            totalCompeticoes: {{ total_competicoes|default:0 }},
            totalResultados: {{ total_resultados|default:0 }},
            medalhas: {
                ouro: {{ medalhas.ouro|default:0 }},
                prata: {{ medalhas.prata|default:0 }},
                bronze: {{ medalhas.bronze|default:0 }}
            }
            {% else %}
            nome: "",
            totalCompeticoes: 0,
            totalResultados: 0,
            medalhas: { ouro: 0, prata: 0, bronze: 0 }
            {% endif %}
        };
        
        // Configurar gráfico de desempenho
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('dashboardPerformanceChart');
            if (ctx && dadosGrafico.length > 0) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labelsGrafico,
                        datasets: [{
                            label: 'Pontuação',
                            data: dadosGrafico,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.1,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: Math.max(...dadosGrafico) + 2
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        }
                    }
                });
            } else if (ctx) {
                // Criar mensagem quando não há dados
                const canvas = ctx.getContext('2d');
                canvas.fillStyle = '#6c757d';
                canvas.font = '16px Arial';
                canvas.textAlign = 'center';
                canvas.fillText('Nenhum dado disponível', ctx.width/2, ctx.height/2);
            }
        });
    </script>
</body>
</html>